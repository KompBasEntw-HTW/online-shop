ARG POSITIONSTACK_API_KEY
ARG AUTH_SECRET
ARG AUTH_KEYCLOAK_ID
ARG AUTH_KEYCLOAK_SECRET
ARG AUTH_KEYCLOAK_ISSUER
ARG AUTH_URL
# Rebuild the source code only when needed
FROM node:lts AS runner
ARG POSITIONSTACK_API_KEY
ARG AUTH_SECRET
ARG AUTH_KEYCLOAK_ID
ARG AUTH_KEYCLOAK_SECRET
ARG AUTH_KEYCLOAK_ISSUER
ARG AUTH_URL

ENV POSITIONSTACK_API_KEY ${POSITIONSTACK_API_KEY}
ENV AUTH_SECRET ${AUTH_SECRET}
ENV AUTH_KEYCLOAK_ID ${AUTH_KEYCLOAK_ID}
ENV AUTH_KEYCLOAK_SECRET ${AUTH_KEYCLOAK_SECRET}
ENV AUTH_KEYCLOAK_ISSUER ${AUTH_KEYCLOAK_ISSUER}
ENV AUTH_URL ${AUTH_URL}

ENV NEXT_TELEMETRY_DISABLED 1

WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm ci
COPY . .

CMD npm run dev
